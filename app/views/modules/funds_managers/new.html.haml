%h1 Завантажити перелік розпорядиків бюджетних коштів

%ul.nav.nav-tabs
  %li.active
    = link_to 'Створити один', '#create-edrpou', aria: { expanded: true }, data: { toggle: 'tab'}
  %li
    = link_to 'Імпортувати файлом', '#import-edrpou', aria: { expanded: true }, data: { toggle: 'tab'}

.tab-content
  #create-edrpou.tab-pane.fade.active.in
    = render 'form'
  #import-edrpou.tab-pane.fade
    = form_tag import_modules_funds_managers_path, multipart: true do
      .form-inputs
        = file_field_tag :file
      .form-group
        %label.control-label
          = t('owner')
        - if current_user && current_user.admin?
          = text_field_tag :town, '', { class: 'town_select form-control', required: true }
        - else
          = ": #{current_user.town_model.title}"

      .form-actions
        = submit_tag 'Import'

= link_to 'Back', modules_funds_managers_path, class: 'btn btn-primary'

:javascript

  $(document).ready(function() {
    var town_select = $(".town_select");

    town_select.select2({
      placeholder: "Вкажіть місто",
      allowClear: false,
      minimumInputLength: 2,
      width: '100%',
      ajax: {
        url: '#{search_town_path}',
        dataType: 'json',
        quietMillis: 250,
        data: function (term, page) {
          return {
            query: term, // search term
          };
        },
        results: function (data, page) {
          return { results: data };
        },
        cache: true
      },
    }).on("change", function(){
      town = $(this).val();
      $.ajax({
        url: "/indicate/indicator_files/get_files/" + town,
        type: "GET",
        dataType: "html",
        success: function(data) {
          $('.documents').html(data);
          $(".can_be_disable").removeAttr('disabled');
        }
      })
    })

    town_select.select2("data", {id: "#{current_user.town_model.id}", text: "#{current_user.town_model.title}" });

  })