=stylesheet_link_tag 'http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css'
=javascript_include_tag 'http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js'
=javascript_include_tag 'http://leaflet.github.io/Leaflet.markercluster/example/realworld.10000.js'
=javascript_include_tag 'https://cdn.jsdelivr.net/npm/heatmapjs@2.0.2/heatmap.min.js'
=javascript_include_tag 'https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js'
-#=javascript_include_tag 'leaflet/leaflet-heat'
:scss
  #map {
    min-height: 90vh;
  }
-#=link_to '#',home_index_path,class: 'btn btn-info'
.container
  #map

:javascript
  $(document).ready(function(){

    var map = L.map('map').setView([48.5, 31.2], 6);

    var layerSettings = {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        id: 'begemot.mbl2go4k',
        accessToken: 'pk.eyJ1IjoiYmVnZW1vdCIsImEiOiJlMjk1ODk0MDIzOTgxODUxNzFjNDk5YTBhNGNmNjQ3YyJ9.N5HyCJcDWeQGJcqCl1nHVQ'
      };

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', layerSettings).addTo(map);

    function addMarkers(markers_data){
      markers = markers_data.features.map(function (p) {
        if (p.geometry.coordinates[0] instanceof Array){
          return [p.geometry.coordinates[0][0], p.geometry.coordinates[0][1],1];
        }
        else if(p.geometry.coordinates[0] && p.geometry.coordinates[1]){
           return [p.geometry.coordinates[0], p.geometry.coordinates[1],1];
        }
       });
       var heat = L.heatLayer(markers).addTo(map);
    }

    $.ajax({
      url: "#{properting_heapmap_json_path}",
      dataType: 'JSON',
      success: function(data) {
        addMarkers(data);
      }
    })
  })
